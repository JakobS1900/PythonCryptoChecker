{% extends "base.html" %}

{% block title %}Crypto Roulette - CryptoChecker v3{% endblock %}

{% block extra_css %}
<!-- Roulette Design System (v3.1) - Load Order Critical -->
<link href="{{ url_for('static', path='/css/roulette-design-system.css') }}?v=2" rel="stylesheet">
<link href="{{ url_for('static', path='/css/roulette-components.css') }}?v=2" rel="stylesheet">
<link href="{{ url_for('static', path='/css/roulette-animations.css') }}?v=2" rel="stylesheet">
<link href="{{ url_for('static', path='/css/roulette.css') }}?v=12" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="gaming-app">
    <!-- Gaming Header - Enhanced v3.1 -->
    <header class="rd-header gaming-header">
        <div class="rd-header-content header-content">
            <!-- Left: Branding -->
            <div class="rd-header-brand brand-section">
                <div class="rd-brand-icon brand-icon">
                    <i class="bi bi-dice-5-fill"></i>
                </div>
                <h1 class="rd-brand-title brand-title">CRYPTO ROULETTE</h1>
                <div class="rd-live-badge live-indicator">
                    <span class="rd-pulse-dot pulse-dot"></span>
                    <span>LIVE</span>
                </div>
            </div>

            <!-- Right: Balance (Hero Element) -->
            <div class="rd-header-balance header-stats">
                <div class="rd-balance-card stat-card">
                    <div class="rd-balance-label stat-label">Balance</div>
                    <div class="rd-balance-value stat-value">
                        <i class="bi bi-gem"></i>
                        <span id="gaming-balance" class="rd-balance-amount">Loading...</span>
                        <span class="rd-balance-currency currency">GEM</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Gaming Area -->
    <main class="gaming-main">
        <!-- Game Status Bar - Enhanced v3.1 -->
        <div class="rd-status-bar game-status-bar" data-phase="betting">
            <div class="rd-status-content status-content">
                <!-- Phase Indicator -->
                <div class="rd-phase-indicator game-phase" id="game-phase" data-phase="betting">
                    <div class="rd-phase-icon">
                        <i class="bi bi-cash-coin"></i>
                    </div>
                    <div class="rd-phase-info">
                        <span class="rd-phase-text phase-text">Place Your Bets</span>
                        <div class="rd-phase-dot phase-indicator betting"></div>
                    </div>
                </div>

                <!-- Recent Results -->
                <div class="rd-recent-results recent-results">
                    <div class="rd-results-label results-label">Recent</div>
                    <div class="rd-results-list results-list" id="recent-results">
                        <!-- Recent results will be populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Progress Bar (Visual Timer) -->
            <div class="rd-status-progress">
                <div class="rd-status-progress-bar" id="phase-timer-bar" style="width: 100%;"></div>
            </div>
        </div>

        <!-- Bot Arena & Timer Section -->
        <div class="bot-arena-container">
            <!-- Bot Activity Arena -->
            <div class="bot-arena-section" id="bot-arena-section">
                <div class="arena-header">
                    <span class="arena-label"><i class="bi bi-robot"></i> BOT ARENA</span>
                    <div class="active-players" id="active-players">
                        <span class="player-count" id="arena-player-count">0 players</span>
                    </div>
                </div>
                <div class="bot-activity-arena" id="bot-activity-arena">
                    <!-- Bot avatars will appear here -->
                    <div class="bot-spinning-wheel" id="bot-spinning-wheel" style="display: none;">
                        <div class="wheel-decoration"><i class="bi bi-controller"></i></div>
                        <span>Bots Calculating Bets...</span>
                        <div class="wheel-decoration"><i class="bi bi-dice-3"></i></div>
                    </div>
                </div>
            </div>

            <!-- Round Timer Bar -->
            <div class="timer-container-with-arena">
                <div class="round-timer-wrapper">
                    <div class="timer-label">
                        <i class="bi bi-clock-history"></i>
                        <span>TIME UNTIL AUTO-SPIN</span>
                    </div>
                    <div class="timer-bar">
                        <div class="timer-progress" id="auto-spin-timer-progress"></div>
                        <span class="timer-text" id="auto-spin-timer-text">15.0s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Roulette Display Section -->
        <section class="roulette-section">
            <div class="roulette-display">
                <div class="previous-rolls" id="previous-rolls">
                    <!-- Previous rolls will be added here -->
                </div>
                <div class="wheel-container" style="height: 120px; position: relative; overflow: hidden; border-radius: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3); margin: 1rem 0;">
                    <div class="wheel-pointer" style="position: absolute; left: 50%; top: 0; height: 100%; width: 3px; background: linear-gradient(to bottom, #00f5ff, #8b5cf6); z-index: 10; box-shadow: 0 0 15px rgba(0, 245, 255, 0.8); transform: translateX(-50%);"></div>
                    <div class="wheel-numbers" id="wheelNumbers" style="position: absolute; top: 0; left: 0; height: 100%; display: flex; white-space: nowrap;">
                        <!-- Wheel will be rendered by JavaScript - see roulette.js -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Betting Interface -->
        <section class="betting-interface">
            <div class="betting-grid">
                <!-- Bet Amount Panel -->
                <div class="bet-panel">
                    <div class="panel-header">
                        <h3 class="panel-title">Bet Amount</h3>
                        <div class="balance-info">
                            <span class="balance-text">Available: <span id="available-balance">0</span> GEM</span>
                        </div>
                    </div>

                    <div class="amount-selector">
                        <div class="rd-chip-grid quick-amounts">
                            <button class="rd-chip-btn chip-btn enhanced-hover smooth-transition pulse-ripple" data-amount="10">
                                <span class="rd-chip-value chip-value">10</span>
                                <div class="rd-chip-glow chip-glow"></div>
                            </button>
                            <button class="rd-chip-btn chip-btn enhanced-hover smooth-transition pulse-ripple" data-amount="50">
                                <span class="rd-chip-value chip-value">50</span>
                                <div class="rd-chip-glow chip-glow"></div>
                            </button>
                            <button class="rd-chip-btn chip-btn enhanced-hover smooth-transition pulse-ripple active" data-amount="100">
                                <span class="rd-chip-value chip-value">100</span>
                                <div class="rd-chip-glow chip-glow"></div>
                            </button>
                            <button class="rd-chip-btn chip-btn enhanced-hover smooth-transition pulse-ripple" data-amount="500">
                                <span class="rd-chip-value chip-value">500</span>
                                <div class="rd-chip-glow chip-glow"></div>
                            </button>
                            <button class="rd-chip-btn chip-btn enhanced-hover smooth-transition pulse-ripple" data-amount="1000">
                                <span class="rd-chip-value chip-value">1K</span>
                                <div class="rd-chip-glow chip-glow"></div>
                            </button>
                        </div>

                        <div class="custom-amount-section">
                            <div class="amount-input-group">
                                <input type="number" id="betAmount" class="amount-input" placeholder="Custom amount" min="10" max="10000" value="100">
                                <span class="input-currency">GEM</span>
                            </div>
                            <div class="amount-controls">
                                <button class="amount-control-btn" id="halfBtn">½</button>
                                <button class="amount-control-btn" id="doubleBtn">2×</button>
                                <button class="amount-control-btn" id="maxBtn">MAX</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Betting Options Panel -->
                <div class="betting-options-panel">
                    <div class="panel-header">
                        <h3 class="panel-title">Place Your Bets</h3>
                        <div class="betting-status">
                            <span class="status-indicator betting-open">Betting Open</span>
                        </div>
                    </div>

                    <div class="betting-grid-layout">
                        <!-- Color Betting Section -->
                        <div class="rd-color-grid color-betting">
                            <button class="rd-color-bet rd-color-bet--red color-bet-btn red-bet bet-btn enhanced-hover" data-type="color" data-value="red">
                                <div class="rd-color-indicator bet-color red"></div>
                                <div class="rd-bet-content bet-info">
                                    <span class="rd-bet-label bet-label">RED</span>
                                    <span class="rd-bet-payout bet-payout">2:1</span>
                                </div>
                                <div class="rd-bet-amount bet-amount-display" id="red-bet-amount">0</div>
                            </button>

                            <button class="rd-color-bet rd-color-bet--green color-bet-btn green-bet bet-btn enhanced-hover" data-type="color" data-value="green">
                                <div class="rd-color-indicator bet-color green"></div>
                                <div class="rd-bet-content bet-info">
                                    <span class="rd-bet-label bet-label">GREEN</span>
                                    <span class="rd-bet-payout bet-payout">14:1</span>
                                </div>
                                <div class="rd-bet-amount bet-amount-display" id="green-bet-amount">0</div>
                            </button>

                            <button class="rd-color-bet rd-color-bet--black color-bet-btn black-bet bet-btn enhanced-hover" data-type="color" data-value="black">
                                <div class="rd-color-indicator bet-color black"></div>
                                <div class="rd-bet-content bet-info">
                                    <span class="rd-bet-label bet-label">BLACK</span>
                                    <span class="rd-bet-payout bet-payout">2:1</span>
                                </div>
                                <div class="rd-bet-amount bet-amount-display" id="black-bet-amount">0</div>
                            </button>
                        </div>

                        <!-- Additional Betting Options -->
                        <div class="additional-bets">
                            <div class="bet-row">
                                <button class="additional-bet-btn bet-btn enhanced-hover smooth-transition" data-type="parity" data-value="odd">
                                    <span class="bet-text">ODD</span>
                                    <span class="bet-payout">2:1</span>
                                    <div class="bet-amount-display">0</div>
                                </button>
                                <button class="additional-bet-btn bet-btn enhanced-hover smooth-transition" data-type="parity" data-value="even">
                                    <span class="bet-text">EVEN</span>
                                    <span class="bet-payout">2:1</span>
                                    <div class="bet-amount-display">0</div>
                                </button>
                            </div>
                            <div class="bet-row">
                                <button class="additional-bet-btn bet-btn enhanced-hover smooth-transition" data-type="range" data-value="1-18">
                                    <span class="bet-text">1-18</span>
                                    <span class="bet-payout">2:1</span>
                                    <div class="bet-amount-display">0</div>
                                </button>
                                <button class="additional-bet-btn bet-btn enhanced-hover smooth-transition" data-type="range" data-value="19-36">
                                    <span class="bet-text">19-36</span>
                                    <span class="bet-payout">2:1</span>
                                    <div class="bet-amount-display">0</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Bets Panel -->
                <div class="active-bets-panel">
                    <div class="panel-header">
                        <h3 class="panel-title">Active Bets</h3>
                        <button class="clear-all-btn" id="clearBets">
                            <i class="fas fa-trash"></i>
                            Clear All
                        </button>
                    </div>

                    <div class="bets-container">
                        <div class="bets-list" id="betsList">
                            <div class="no-bets-message">
                                <i class="bi bi-dice-3"></i>
                                <span>No active bets</span>
                            </div>
                        </div>

                        <div class="bets-summary">
                            <div class="summary-row">
                                <span class="summary-label">Total Wagered:</span>
                                <span class="summary-value" id="totalBet">0 GEM</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Potential Win:</span>
                                <span class="summary-value potential" id="potentialWin">0 GEM</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="action-btn spin-btn enhanced-hover" id="spinWheel" disabled>
                                <i class="bi bi-play-fill"></i>
                                <span>SPIN TO WIN</span>
                                <div class="button-shine"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Panel -->
        <section class="history-panel">
            <h3>Previous Results</h3>
            <div class="rolls-history" id="rollsHistory">
                <!-- History will be populated by JavaScript -->
            </div>
        </section>

        <!-- GEM Earning Panel -->
        <section class="gem-earning-panel" id="gem-earning-panel" style="display: none;">
            <div class="earning-header">
                <h3><i class="bi bi-coin"></i> Get More GEM</h3>
                <button class="close-earning-btn" id="close-earning-btn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <div class="earning-content">
                <!-- Quick Links Section -->
                <div class="earning-quick-links">
                    <a href="/challenges" class="earning-link-card">
                        <div class="link-icon">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <div class="link-info">
                            <h4>Daily Challenges</h4>
                            <p>Complete daily quests and maintain your login streak for bonus GEM!</p>
                        </div>
                        <div class="link-arrow">
                            <i class="bi bi-arrow-right"></i>
                        </div>
                    </a>

                    <a href="/achievements" class="earning-link-card">
                        <div class="link-icon">
                            <i class="bi bi-trophy"></i>
                        </div>
                        <div class="link-info">
                            <h4>Achievements</h4>
                            <p>Unlock achievements and claim GEM rewards for your accomplishments!</p>
                        </div>
                        <div class="link-arrow">
                            <i class="bi bi-arrow-right"></i>
                        </div>
                    </a>
                </div>

                <!-- Emergency Tasks Tab -->
                <div class="earning-tab-content active" id="emergency-tasks-content">
                    <div class="emergency-section">
                        <div class="emergency-header">
                            <h4><i class="bi bi-exclamation-triangle"></i> Emergency GEM Tasks</h4>
                            <p class="emergency-description">Quick tasks to earn GEM when you're running low on balance!</p>
                        </div>
                        <div class="emergency-tasks-list" id="emergency-tasks-list">
                            <div class="tasks-loading">
                                <i class="bi bi-arrow-clockwise spin"></i>
                                <span>Loading emergency tasks...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Win/Loss Notifications -->
    <div class="notification-overlay" id="notification-overlay">
        <div class="notification win-notification" id="win-notification">
            <div class="notification-content">
                <div class="win-icon">
                    <i class="bi bi-trophy-fill"></i>
                </div>
                <div class="win-text">
                    <div class="win-title">CONGRATULATIONS!</div>
                    <div class="win-amount" id="win-amount">+500 GEM</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievement Unlock Modal -->
    <div class="achievement-modal" id="achievement-modal" style="display: none;">
        <div class="modal-content achievement-content">
            <div class="achievement-celebration">
                <div class="achievement-icon">
                    <i class="bi bi-trophy-fill achievement-trophy"></i>
                </div>
                <h3 class="achievement-title">Achievement Unlocked!</h3>
                <div class="achievement-name" id="achievement-name">First Bet</div>
                <div class="achievement-description" id="achievement-description">You placed your first bet!</div>
                <div class="achievement-reward">
                    <i class="bi bi-gem"></i>
                    <span id="achievement-reward-amount">50 GEM</span> Earned!
                </div>
                <button class="claim-achievement-btn" id="claim-achievement-btn">
                    <i class="bi bi-cash-coin"></i>
                    Claim Reward
                </button>
            </div>
        </div>
    </div>

    <!-- Emergency Task Modal -->
    <div class="task-modal" id="task-modal" style="display: none;">
        <div class="modal-content task-content">
            <div class="task-header">
                <h3 id="task-title">Watch Advertisement</h3>
                <button class="close-task-btn" id="close-task-btn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="task-body">
                <div class="task-description" id="task-description">
                    Watch a short advertisement to earn emergency GEM!
                </div>
                <div class="task-reward">
                    Reward: <span id="task-reward-amount">25</span> GEM
                </div>
                <div class="task-action" id="task-action">
                    <!-- Dynamic task content will be loaded here -->
                </div>
            </div>
            <div class="task-footer">
                <button class="complete-task-btn" id="complete-task-btn">
                    <i class="bi bi-check-lg"></i>
                    Complete Task
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Socket.IO -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<!-- Font Awesome -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
<!-- Game script -->
<script src="{{ url_for('static', path='/js/roulette.js') }}?v=16"></script>
<!-- GEM Earning System script -->
<script src="{{ url_for('static', path='/js/gem-earning.js') }}"></script>
<script>
// Clean initialization - RouletteGame class handles everything
console.log('🎰 CryptoChecker Roulette V3 Ready - RouletteGame will initialize automatically');

// Sync balance when gaming page loads
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit for everything to initialize, then sync balance
    setTimeout(() => {
        if (typeof window.syncGamingBalance === 'function') {
            window.syncGamingBalance();
            console.log('🎮 Gaming balance synced with real-time system');
        }
    }, 500);
});
</script>
{% endblock %}
