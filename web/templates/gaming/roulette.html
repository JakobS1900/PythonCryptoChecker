{% extends "base.html" %}
{% block title %}Crypto Roulette - Gaming Platform{% endblock %}
{% block body_class %}gaming-page{% endblock %}

{% block extra_css %}
<style>
/* Enhanced Crypto Roulette Styling */
.gaming-page {
    background: linear-gradient(135deg, #0f1419 0%, #1a1a2e 50%, #16213e 100%);
    min-height: 100vh;
}

.roulette-main-container {
    background: transparent;
    padding: 20px 0;
}

/* Crypto Style Header */
.roulette-header {
    background: rgba(0, 0, 0, 0.7);
    border-bottom: 2px solid #fbbf24;
    padding: 15px 0;
    margin-bottom: 20px;
}

.roulette-title {
    color: #fbbf24;
    font-size: 2rem;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

/* Roulette Wheel Container */
.roulette-wheel-section {
    background: rgba(0, 0, 0, 0.6);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 20px;
    border: 1px solid rgba(251, 191, 36, 0.3);
}

.wheel-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    background: radial-gradient(circle, #1a1a2e 0%, #0f1419 100%);
    border-radius: 20px;
    padding: 20px;
    overflow: hidden;
}

/* Numbers Strip (Horizontal Layout) */
#wheelsHolder {
    position: relative;
    width: 100%;
    height: 80px;
    background: #16213e;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid #fbbf24;
}

.wheels-content {
    display: flex;
    height: 100%;
    will-change: transform;
}

/* Center pointer indicator */
.roulette-pointer {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 50%;
    width: 2px;
    background: rgba(251, 191, 36, 0.9);
    box-shadow: 0 0 8px rgba(251, 191, 36, 0.8);
    transform: translateX(-1px);
    z-index: 5;
    pointer-events: none;
}

.wheel {
    display: flex;
    height: 100%;
    transition: transform 6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.chunk {
    min-width: 70px;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    border-right: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
}

.green-number {
    background: linear-gradient(45deg, #10b981, #059669);
    color: white;
}

.red-number {
    background: linear-gradient(45deg, #ef4444, #dc2626);
    color: white;
}

.black-number {
    background: linear-gradient(45deg, #374151, #1f2937);
    color: white;
}

.winning-segment {
    animation: winningPulse 2s ease-in-out;
    border: 3px solid #fbbf24 !important;
}

@keyframes winningPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.spinning-effects {
    animation: spinGlow 6s ease-in-out;
}

@keyframes spinGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.3); }
    50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.8); }
}

/* Previous Rolls */
.previous-rolls {
    margin-top: 20px;
    text-align: center;
}

.numbers-display {
    display: flex;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
}

.number-chip {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9rem;
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

/* Betting Interface */
.betting-section {
    background: rgba(0, 0, 0, 0.6);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(251, 191, 36, 0.3);
}

.betting-grid {
    display: grid;
    gap: 15px;
    margin-bottom: 20px;
}

.bet-category {
    background: rgba(22, 33, 62, 0.8);
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(251, 191, 36, 0.2);
}

.bet-category h5 {
    color: #fbbf24;
    margin-bottom: 10px;
    font-weight: bold;
}

.bet-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.bet-btn {
    padding: 10px 15px;
    border: 2px solid transparent;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 60px;
    text-align: center;
}

.bet-btn:hover {
    background: rgba(251, 191, 36, 0.2);
    border-color: #fbbf24;
    transform: translateY(-2px);
}

.bet-btn.bet-placed {
    background: #fbbf24;
    color: #0f1419;
    border-color: #fbbf24;
}

/* Number Grid */
.number-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
    gap: 8px;
    max-width: 600px;
}

/* Color Betting */
.color-betting .bet-btn {
    min-width: 120px;
    padding: 15px;
}

.red-btn {
    background: linear-gradient(45deg, #ef4444, #dc2626);
}

.black-btn {
    background: linear-gradient(45deg, #374151, #1f2937);
}

.green-btn {
    background: linear-gradient(45deg, #10b981, #059669);
}

/* Game Controls */
.game-controls {
    background: rgba(0, 0, 0, 0.6);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(251, 191, 36, 0.3);
}

.bet-amount-section {
    margin-bottom: 20px;
}

.bet-amount-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.bet-amount-btn {
    padding: 8px 16px;
    border: 2px solid #fbbf24;
    border-radius: 6px;
    background: transparent;
    color: #fbbf24;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.bet-amount-btn:hover,
.bet-amount-btn.active {
    background: #fbbf24;
    color: #0f1419;
}

.max-btn {
    background: linear-gradient(45deg, #ef4444, #dc2626) !important;
    color: white !important;
    border-color: #ef4444 !important;
}

.max-btn:hover {
    background: linear-gradient(45deg, #dc2626, #b91c1c) !important;
}

.custom-amount-section {
    margin-top: 15px;
}

.custom-bet-input {
    background: rgba(0, 0, 0, 0.3) !important;
    border: 1px solid #fbbf24 !important;
    color: #fbbf24 !important;
    border-radius: 4px 0 0 4px !important;
}

.custom-bet-input:focus {
    box-shadow: 0 0 0 0.2rem rgba(251, 191, 36, 0.25) !important;
    border-color: #fbbf24 !important;
    background: rgba(0, 0, 0, 0.4) !important;
    color: #fbbf24 !important;
}

.custom-bet-input::placeholder {
    color: rgba(251, 191, 36, 0.6) !important;
}

.bet-validation-feedback {
    margin-top: 5px;
    font-size: 0.8rem;
    text-align: center;
}

.bet-validation-feedback.valid {
    color: #10b981;
}

.bet-validation-feedback.invalid {
    color: #ef4444;
}

.bet-validation-feedback.warning {
    color: #f59e0b;
}

.balance-display {
    background: rgba(16, 185, 129, 0.2);
    border: 1px solid #10b981;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
    margin-bottom: 20px;
}

.action-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.action-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    flex: 1;
    min-width: 120px;
}

.spin-btn {
    background: linear-gradient(45deg, #10b981, #059669);
    color: white;
}

.spin-btn:hover {
    background: linear-gradient(45deg, #059669, #047857);
    transform: translateY(-2px);
}

.clear-btn {
    background: linear-gradient(45deg, #ef4444, #dc2626);
    color: white;
}

.clear-btn:hover {
    background: linear-gradient(45deg, #dc2626, #b91c1c);
    transform: translateY(-2px);
}

.repeat-btn {
    background: linear-gradient(45deg, #8b5cf6, #7c3aed);
    color: white;
}

.repeat-btn:hover {
    background: linear-gradient(45deg, #7c3aed, #6d28d9);
    transform: translateY(-2px);
}

/* Active Bets Display */
.active-bets-section {
    background: rgba(0, 0, 0, 0.6);
    border-radius: 15px;
    padding: 20px;
    border: 1px solid rgba(251, 191, 36, 0.3);
    margin-top: 20px;
}

.bet-item {
    background: rgba(22, 33, 62, 0.6);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 10px;
    border-left: 4px solid #fbbf24;
}

.bet-summary {
    display: flex;
    justify-content: between;
    align-items: center;
    gap: 15px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(251, 191, 36, 0.3);
}

/* Notifications */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    border-left: 4px solid #fbbf24;
    z-index: 1000;
    transform: translateX(400px);
    transition: transform 0.3s ease;
    max-width: 350px;
}

.notification.show {
    transform: translateX(0);
}

.notification-success {
    border-left-color: #10b981;
}

.notification-error {
    border-left-color: #ef4444;
}

.notification-warning {
    border-left-color: #f59e0b;
}

/* Modal Styling */
.game-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.game-modal.show {
    opacity: 1;
}

.modal-content {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 15px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    border: 2px solid #fbbf24;
    position: relative;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(251, 191, 36, 0.3);
}

.modal-header h3 {
    color: #fbbf24;
    margin: 0;
}

.close-btn {
    background: none;
    border: none;
    color: #fbbf24;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px 10px;
}

.close-btn:hover {
    background: rgba(251, 191, 36, 0.2);
    border-radius: 4px;
}

.result-info {
    text-align: center;
    color: white;
}

.payout-item {
    background: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
}

.provably-fair {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(251, 191, 36, 0.3);
    font-size: 0.9rem;
}

/* Floating Chip Animation */
.floating-chip {
    position: fixed;
    background: #fbbf24;
    color: #0f1419;
    padding: 4px 8px;
    border-radius: 50%;
    font-weight: bold;
    font-size: 0.8rem;
    pointer-events: none;
    z-index: 1500;
    animation: floatUp 1.5s ease-out forwards;
}

@keyframes floatUp {
    0% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-100px) scale(0.5);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .betting-grid {
        grid-template-columns: 1fr;
    }
    
    .number-grid {
        grid-template-columns: repeat(6, 1fr);
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .action-btn {
        min-width: auto;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="roulette-main-container">
    <!-- Header -->
    <div class="roulette-header">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1 class="roulette-title">üé∞ Crypto Roulette</h1>
                    <p class="text-light mb-0">Professional crypto roulette with provably fair mechanics</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <!-- Main Game Area -->
            <div class="col-lg-8">
                <!-- Roulette Wheel Section -->
                <div class="roulette-wheel-section">
                    <div class="wheel-container">
                        <h4 class="text-center text-light mb-3">üé≤ Roulette Wheel</h4>
                        
                        <!-- Horizontal Number Strip -->
                        <div id="wheelsHolder">
                            <div class="roulette-pointer"></div>
                            <div id="wheelsContent" class="wheels-content"><!-- JS populates repeated number strips --></div>
                        </div>
                        
                        <!-- Previous Rolls -->
                        <div class="previous-rolls" id="last-numbers">
                            <h5 class="text-light mb-2">Previous Rolls:</h5>
                            <div class="numbers-display">
                                <!-- Previous numbers will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Betting Interface -->
                <div class="betting-section">
                    <h4 class="text-light mb-3">üéØ Place Your Bets</h4>
                    
                    <div class="betting-grid">
                        <!-- Number Betting -->
                        <div class="bet-category">
                            <h5>Individual Numbers (35:1)</h5>
                            <div class="bet-buttons number-grid" id="number-betting">
                                <!-- Numbers 0-36 will be generated by JavaScript -->
                            </div>
                        </div>

                        <!-- Color Betting -->
                        <div class="bet-category color-betting">
                            <h5>Color Betting</h5>
                            <div class="bet-buttons">
                                <button class="bet-btn color-btn red-btn" data-color="red">Red (1:1)</button>
                                <button class="bet-btn color-btn black-btn" data-color="black">Black (1:1)</button>
                                <button class="bet-btn color-btn green-btn" data-color="green">Green (35:1)</button>
                            </div>
                        </div>

                        <!-- Category Betting -->
                        <div class="bet-category">
                            <h5>Category Betting (2:1)</h5>
                            <div class="bet-buttons">
                                <button class="bet-btn category-btn" data-category="defi">DeFi Tokens</button>
                                <button class="bet-btn category-btn" data-category="gaming">Gaming Coins</button>
                                <button class="bet-btn category-btn" data-category="layer1">Layer 1</button>
                                <button class="bet-btn category-btn" data-category="privacy">Privacy Coins</button>
                            </div>
                        </div>

                        <!-- Traditional Betting -->
                        <div class="bet-category">
                            <h5>Traditional Betting (1:1)</h5>
                            <div class="bet-buttons">
                                <button class="bet-btn traditional-btn" data-type="even">Even</button>
                                <button class="bet-btn traditional-btn" data-type="odd">Odd</button>
                                <button class="bet-btn traditional-btn" data-type="low">Low (1-18)</button>
                                <button class="bet-btn traditional-btn" data-type="high">High (19-36)</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar with Game Controls -->
            <div class="col-lg-4">
                <!-- Game Controls -->
                <div class="game-controls">
                    <!-- Balance Display -->
                    <div class="balance-display">
                        <h5 class="text-success mb-1">üí∞ Wallet Balance</h5>
                        <div class="h4 text-light" id="walletBalance">1,000 GEM</div>
                    </div>

                    <!-- Bet Amount Selection -->
                    <div class="bet-amount-section">
                        <h5 class="text-light">üíé Bet Amount</h5>
                        <div class="bet-amount-buttons">
                            <button class="bet-amount-btn" data-amount="10">10</button>
                            <button class="bet-amount-btn" data-amount="25">25</button>
                            <button class="bet-amount-btn" data-amount="50">50</button>
                            <button class="bet-amount-btn" data-amount="100">100</button>
                            <button class="bet-amount-btn" data-amount="250">250</button>
                            <button class="bet-amount-btn" data-amount="500">500</button>
                            <button class="bet-amount-btn max-btn" id="max-bet-btn">MAX</button>
                        </div>
                        
                        <!-- Custom Amount Input -->
                        <div class="custom-amount-section mt-3">
                            <div class="input-group">
                                <input type="number" 
                                       class="form-control custom-bet-input" 
                                       id="custom-bet-amount" 
                                       placeholder="Custom amount" 
                                       min="10" 
                                       max="10000"
                                       step="1">
                                <button class="btn btn-outline-warning" type="button" id="set-custom-amount">
                                    Set
                                </button>
                            </div>
                            <div class="bet-validation-feedback" id="bet-validation-message"></div>
                        </div>
                        
                        <div class="text-center mt-2">
                            <span class="text-light">Current: </span>
                            <span class="text-warning h5" id="bet-amount-display">0 GEM</span>
                        </div>
                        
                        <!-- Potential Winnings Display -->
                        <div class="text-center mt-1">
                            <small class="text-muted">Potential win: </small>
                            <small class="text-success" id="potential-winnings">0 GEM</small>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button id="spin-btn" class="action-btn spin-btn">üé≤ Spin Wheel</button>
                        <button id="clear-bets" class="action-btn clear-btn">üóëÔ∏è Clear All</button>
                        <button id="repeat-last" class="action-btn repeat-btn">üîÑ Repeat</button>
                    </div>

                    <!-- Game Status -->
                    <div class="text-center mt-3">
                        <div id="betting-time" class="text-warning h6">20s</div>
                        <div class="progress" style="height: 8px;">
                            <div id="betting-bar" class="progress-bar bg-warning" style="width: 100%;"></div>
                        </div>
                    </div>
                </div>

                <!-- Active Bets -->
                <div class="active-bets-section">
                    <h5 class="text-light mb-3">üéØ Your Bets</h5>
                    <div id="active-bets">
                        <div class="text-center text-muted py-3">No active bets</div>
                    </div>
                    
                    <div class="bet-summary">
                        <div>
                            <span class="text-light">Total Bet:</span>
                            <span class="text-warning h6" id="total-bet-amount">0 GEM</span>
                        </div>
                        <div>
                            <span class="text-light">Potential Win:</span>
                            <span class="text-success h6" id="potential-win-amount">0 GEM</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include JavaScript -->
<script src="/static/js/enhanced-roulette.js"></script>

<script>
// Additional initialization
document.addEventListener('DOMContentLoaded', function() {
    // Generate number betting grid
    const numberBetting = document.getElementById('number-betting');
    for (let i = 0; i <= 36; i++) {
        const btn = document.createElement('button');
        btn.className = `bet-btn number-btn ${i === 0 ? 'green-number' : (
            [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36].includes(i) ? 'red-number' : 'black-number'
        )}`;
        btn.dataset.number = i;
        btn.textContent = i;
        numberBetting.appendChild(btn);
    }
    
    console.log('Crypto Roulette interface initialized successfully');
});
</script>
{% endblock %}
